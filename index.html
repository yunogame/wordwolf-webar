<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>WordWolf WebAR</title>
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.1.4/dist/aframe/mindar-face-aframe.prod.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #buttonContainer {
        position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
        background: rgba(0,0,0,0.5); padding: 10px; border-radius: 10px; color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      button {
        margin-top: 10px;
        padding: 8px 12px;
        font-size: 1em;
      }
      #wordDisplay {
        margin-top: 10px;
        min-height: 1.2em;
      }
    </style>
  </head>
  <body>
    <div id="buttonContainer">
      <button id="showWord">お題を見る</button>
      <div id="wordDisplay"></div>
    </div>

    <a-scene mindar-face embedded color-space="sRGB" vr-mode-ui="enabled: false"
             device-orientation-permission-ui="enabled: true">
      <a-entity mindar-face-target="anchorIndex: 0">
        <a-box color="red" depth="0.1" height="0.1" width="0.1" position="0 0 0"></a-box>
      </a-entity>
      <a-camera active="true" position="0 0 0"></a-camera>
    </a-scene>

    <script>
      const words = [
        ["りんご", "バナナ"],
        ["サッカー", "野球"],
        ["猫", "犬"],
        ["学校", "会社"],
        ["コーヒー", "紅茶"]
      ];
      const wordSet = words[Math.floor(Math.random() * words.length)];
      const liarIndex = Math.floor(Math.random() * 4);
      let shown = 0;

      const buttonContainer = document.getElementById("buttonContainer");

      function showWordHandler() {
        if (localStorage.getItem("wordwolf_seen") === "yes") return;

        if (shown >= 4) {
          wordDisplay.innerText = "全員分表示済みです";
          return;
        }

        const word = (shown === liarIndex) ? wordSet[1] : wordSet[0];
        wordDisplay.innerText = `あなたのお題：${word}`;
        shown++;

        localStorage.setItem("wordwolf_seen", "yes");
        showWordBtn.disabled = true;
      }

      function setupInitialUI() {
        buttonContainer.innerHTML = `
          <button id="showWord">お題を見る</button>
          <div id="wordDisplay"></div>
        `;

        const showWordBtn = document.getElementById("showWord");
        const wordDisplay = document.getElementById("wordDisplay");

        showWordBtn.disabled = false;
        wordDisplay.innerText = "";
        shown = 0;
        localStorage.removeItem("wordwolf_seen");  // もしリセットしたければ外す

        showWordBtn.addEventListener("click", showWordHandler);
      }

      if (localStorage.getItem("wordwolf_seen") === "yes") {
        // すでに見た端末用UI
        buttonContainer.innerHTML = `
          <div>この端末ではすでにお題を見ました</div>
          <button id="backButton">戻る</button>
        `;
        document.getElementById("backButton").addEventListener("click", () => {
          setupInitialUI();
        });
      } else {
        // 通常のUI
        setupInitialUI();
      }
    </script>
  </body>
</html>

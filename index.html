<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Firebase動作テスト</title>
  <!-- Firebase compat SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <h2>ゲーム作成テスト</h2>
  <label>参加人数<input type="number" id="playerCount" value="4" min="2" max="20" /></label>
  <button id="createGame">ゲーム作成</button>
  <p id="result"></p>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBAJQBcqvVUEfmdIaWutofWY2MbfuNoX2c",
      authDomain: "wordwolf-webar.firebaseapp.com",
      databaseURL: "https://wordwolf-webar-default-rtdb.firebaseio.com",
      projectId: "wordwolf-webar",
      storageBucket: "wordwolf-webar.appspot.com",
      messagingSenderId: "422294380099",
      appId: "1:422294380099:web:5df64a14defed9ae487ef6",
      measurementId: "G-XZ7FETM5XF"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function generateGameId() {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let id = "";
      for(let i=0; i<6; i++) id += chars.charAt(Math.floor(Math.random()*chars.length));
      return id;
    }

    document.getElementById("createGame").addEventListener("click", () => {
      const count = parseInt(document.getElementById("playerCount").value);
      if(isNaN(count) || count < 2){
        alert("参加人数は2人以上で設定してください");
        return;
      }
      const gameId = generateGameId();
      const gameData = {
        totalPlayers: count,
        status: "waiting",
        createdAt: Date.now()
      };

      db.ref("games/" + gameId).set(gameData)
        .then(() => {
          console.log("ゲーム作成成功: " + gameId);
          document.getElementById("result").textContent = "ゲーム作成成功！ID: " + gameId;
        })
        .catch((e) => {
          console.error("ゲーム作成失敗:", e);
          document.getElementById("result").textContent = "ゲーム作成失敗: " + e.message;
        });
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>WordWolf オフライン版</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 20px; background: #222; color: white; }
    .container { max-width: 600px; margin: auto; text-align: center; }
    button, select { margin-top: 10px; padding: 10px; font-size: 1em; }
    #result, #voteSection, #finalResult { margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>WordWolf オフライン</h1>

    <div id="setup">
      <label>参加人数: </label>
      <input type="number" id="playerCount" min="2" max="20" value="4"><br>
      <label>あなたは何番目のプレイヤー？</label>
      <input type="number" id="playerNumber" min="1" max="20"><br>
      <button id="startGame">ゲーム開始</button>
    </div>

    <div id="game" style="display:none;">
      <p id="yourWord">お題を読み込んでいます...</p>
      <button id="voteBtn">投票に進む</button>
    </div>

    <div id="voteSection" style="display:none;">
      <p>怪しいと思うプレイヤーの番号を選んでください：</p>
      <select id="voteSelect"></select><br>
      <button id="submitVote">投票する</button>
    </div>

    <div id="finalResult" style="display:none;">
      <h3>投票結果</h3>
      <div id="voteResults"></div>
      <p id="correctWolf"></p>
      <button onclick="location.reload()">再プレイ</button>
    </div>
  </div>

<script>
const words = [
  ["りんご", "バナナ"],
  ["サッカー", "野球"],
  ["猫", "犬"],
  ["学校", "会社"],
  ["コーヒー", "紅茶"]
];
let playerCount = 0;
let playerNumber = 0;
let liarIndex = 0;
let voteCounts = {};
let voted = false;

document.getElementById("startGame").addEventListener("click", () => {
  playerCount = parseInt(document.getElementById("playerCount").value);
  playerNumber = parseInt(document.getElementById("playerNumber").value);

  if (isNaN(playerCount) || isNaN(playerNumber) || playerNumber < 1 || playerNumber > playerCount) {
    alert("正しい人数と自分のプレイヤー番号を入力してください");
    return;
  }

  const set = words[Math.floor(Math.random() * words.length)];
  liarIndex = Math.floor(Math.random() * playerCount);
  const isLiar = (playerNumber - 1 === liarIndex);
  const myWord = isLiar ? set[1] : set[0];
  document.getElementById("yourWord").innerText = "あなたのお題は: " + myWord;

  localStorage.setItem("wordwolf_seen", "yes");
  localStorage.setItem("wordwolf_player_number", playerNumber);
  localStorage.setItem("wordwolf_word", myWord);
  localStorage.setItem("wordwolf_liar", liarIndex);

  document.getElementById("setup").style.display = "none";
  document.getElementById("game").style.display = "block";

  // 投票選択肢をセットアップ
  const voteSelect = document.getElementById("voteSelect");
  for (let i = 1; i <= playerCount; i++) {
    const option = document.createElement("option");
    option.value = i;
    option.text = `${i}番のプレイヤー`;
    voteSelect.appendChild(option);
  }
});

document.getElementById("voteBtn").addEventListener("click", () => {
  document.getElementById("game").style.display = "none";
  document.getElementById("voteSection").style.display = "block";
});

document.getElementById("submitVote").addEventListener("click", () => {
  if (voted) return;
  const votedFor = document.getElementById("voteSelect").value;
  voteCounts[votedFor] = (voteCounts[votedFor] || 0) + 1;
  voted = true;

  // 仮に1端末用なので即結果
  document.getElementById("voteSection").style.display = "none";
  document.getElementById("finalResult").style.display = "block";

  let resultHTML = "";
  for (const key in voteCounts) {
    resultHTML += `${key}番に ${voteCounts[key]} 票<br>`;
  }
  document.getElementById("voteResults").innerHTML = resultHTML;

  const liar = parseInt(localStorage.getItem("wordwolf_liar")) + 1;
  document.getElementById("correctWolf").innerText = `正解のウルフは ${liar} 番のプレイヤーです`;
});
</script>
</body>
</html>
